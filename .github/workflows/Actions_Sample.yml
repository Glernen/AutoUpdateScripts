# File: .github/workflows/repo-sync.yml
# ã€ä½¿ç”¨é™åˆ¶ã€‘
# æ¯ä¸ªä»“åº“åªèƒ½åŒæ—¶æ”¯æŒ20ä¸ª workflow å¹¶è¡Œã€‚
# æ¯å°æ—¶å¯ä»¥è°ƒç”¨1000æ¬¡ GitHub API ã€‚
# æ¯ä¸ª job æœ€å¤šå¯ä»¥æ‰§è¡Œ6ä¸ªå°æ—¶ã€‚
# å…è´¹ç‰ˆçš„ç”¨æˆ·æœ€å¤§æ”¯æŒ20ä¸ª job å¹¶å‘æ‰§è¡Œï¼ŒmacOS æœ€å¤§åªæ”¯æŒ5ä¸ªã€‚
# ç§æœ‰ä»“åº“æ¯æœˆç´¯è®¡ä½¿ç”¨æ—¶é—´ä¸º2000åˆ†é’Ÿï¼Œè¶…è¿‡å$ 0.008/åˆ†é’Ÿï¼Œå…¬å…±ä»“åº“åˆ™æ— é™åˆ¶ã€‚

#åºŸå¼ƒã€‚åˆå¹¶åˆ°åŒä¸€æ–‡ä»¶å†…
name: Github Actions æ•™ç¨‹èŒƒæ–‡

#è§¦å‘ä»»åŠ¡çš„æ–¹å¼
#å¤šè¡Œã€å¤šä¸ªè§¦å‘äº‹ä»¶ï¼Œåœ¨æ²¡æœ‰å…¶å®ƒé€‰é¡¹éœ€è¦å®šä¹‰çš„æƒ…å†µä¸‹ï¼Œæœ€ååŠ ä¸ªå†’å·å°±è¡Œäº†ã€‚
# on:
#   workflow_dispatch:
#   repository_dispatch:

on:
  #1ã€å®šæ—¶è§¦å‘å·¥ä½œæµç¨‹
  #  å…³é”®è¯schedule:
  #schedule:
    #- cron: '0 */3 * * *'

  #2ã€åœ¨ Actions -> workflow é¡µé¢æ˜¾ç¤ºRun workflowæŒ‰é’®
  workflow_dispatch:

  #3ã€é€šè¿‡ç‚¹å‡»ä»“åº“ä¸Šçš„StaræŒ‰é’®è§¦å‘å·¥ä½œæµç¨‹
  #  ä»“åº“è¢« star æ—¶è§¦å‘
  #  æ³¨æ„ï¼šä¸ºäº†é¿å…å…¶ä»–äººç‚¹å‡»Starè§¦å‘æµç¨‹
  #  éœ€è¦æ·»åŠ ã€if: github.event.repository.owner.id == github.event.sender.idã€‘å­—æ®µ
  # watch:
  #   types: started

  #4ã€push æŒ‡å®šåˆ†æ”¯è§¦å‘
  #  pushæ¨é€åˆ°masteråˆ†æ”¯è§¦å‘
  push:
    branches:
      - master

  repository_dispatch:
    types: repo-sync


# å½“æœ‰å¤šä¸ªä»»åŠ¡æ—¶ï¼Œå¯ä»¥æŒ‡å®šä»»åŠ¡çš„ä¾èµ–å…³ç³»ï¼Œå³è¿è¡Œé¡ºåºï¼Œå¦åˆ™æ˜¯åŒæ—¶è¿è¡Œã€‚
# 
# jobs:
#   job1:
#   job2:
#     needs: job1
#   job3:
#     needs: [job1, job2]
# 
# ä¸Šé¢ä»£ç ä¸­ï¼Œjob1 å¿…é¡»å…ˆäº job2 å®Œæˆï¼Œè€Œ job3 ç­‰å¾… job1 å’Œ job2 çš„å®Œæˆæ‰èƒ½è¿è¡Œã€‚
# å› æ­¤ï¼Œè¿™ä¸ª workÂ­flow çš„è¿è¡Œé¡ºåºä¾æ¬¡ä¸ºï¼šjob1ã€job2ã€job3ã€‚

jobs:
  job1: 
    #  runs-on: å­—æ®µæŒ‡å®šä»»åŠ¡è¿è¡Œæ‰€éœ€è¦çš„è™šæ‹ŸæœåŠ¡å™¨ç¯å¢ƒï¼Œæ˜¯å¿…å¡«å­—æ®µ
    #  Windows Server 2019 | windows-latest
    #  Ubuntu 18.04 | ubuntu-latest or ubuntu-18.04
    #  Ubuntu 16.04 | ubuntu-16.04
    #  macOS X Catalina 10.15 | macos-latest
    runs-on: ubuntu-latest


    #ä¸‹é¢å­—æ®µå‘¼åº”è§¦å‘ä»»åŠ¡ä¸­ç¬¬ä¸‰ä¸ªæ–¹æ¡ˆ[ç‚¹å‡»StaræŒ‰é’®è§¦å‘å·¥ä½œæµç¨‹]ä»“åº“è¢« star æ—¶è§¦å‘
    #è¿™æ ·åªæœ‰ä»“åº“æ‰€æœ‰è€…ï¼Œä¹Ÿå°±æ˜¯ä½ è‡ªå·±ç‚¹ Star æ‰èƒ½è§¦å‘å·¥ä½œæµç¨‹ã€‚
    if: github.event.repository.owner.id == github.event.sender.id


    # steps å­—æ®µæŒ‡å®šæ¯ä¸ªä»»åŠ¡çš„è¿è¡Œæ­¥éª¤ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤ã€‚æ­¥éª¤å¼€å¤´ä½¿ç”¨ - ç¬¦å·ã€‚æ¯ä¸ªæ­¥éª¤å¯ä»¥æŒ‡å®šä»¥ä¸‹å­—æ®µ:
    # 
    # nameï¼šæ­¥éª¤åç§°ã€‚
    # usesï¼šè¯¥æ­¥éª¤å¼•ç”¨çš„actionæˆ– Docker é•œåƒã€‚
    # runï¼šè¯¥æ­¥éª¤è¿è¡Œçš„ bash å‘½ä»¤ã€‚
    # envï¼šè¯¥æ­¥éª¤æ‰€éœ€çš„ç¯å¢ƒå˜é‡ã€‚
    # 
    # å…¶ä¸­ uses å’Œ run æ˜¯å¿…å¡«å­—æ®µï¼Œæ¯ä¸ªæ­¥éª¤åªèƒ½æœ‰å…¶ä¸€ã€‚åŒæ ·åç§°ä¹Ÿæ˜¯å¯ä»¥å¿½ç•¥çš„ã€‚
    steps:
      - uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: å¼€å§‹è‡ªåŠ¨åŒæ­¥ğŸ”„
        uses: repo-sync/github-sync@v2
        if: env.PAT
        with:
          source_repo: "https://github.com/SuperManito/JD-FreeFuck.git"
          source_branch: "source"
          destination_branch: "DockerSource"
          github_token: ${{ github.event.client_payload.PAT || secrets.PAT }}
